\chapter[Diffusion for Multiple Scattering in Participating Media]{Diffusion Approximation for Multiple Scattering in Participating Media}
%
\label{sec:diffusion_approximation}

In the previous chapter the angular variable of the radiative transfer equation was discretized into a set of coupled partial differential equations, namely the $P_N$-equations. Further a method has been introduced for discretizing these equations into a system of linear equations, which could be solved by using standard methods. Since the number of equations depends on the truncation order $N$, higher $N$ will result in increasingly larger systems. The results showed that the amount of computational resources required makes this approach very unattractive for practical rendering applications, especially for higher $N$ (section~\ref{sec:pn_results}). This chapter revisits the diffusion approximation, a theory, which is derived from the general $P_N$-equations with a truncation order of $N=1$. It is particularly appealing as it reduces to a simple diffusion equation which can be solved very efficiently. This theory is an important step in trying to derive a practical deterministic method from the spherical harmonics expansion of the radiative transfer equation.

The diffusion approximation has been introduced to computer graphics by Stam~\cite{Stam95} for dealing with multiple scattering in participating media. Therefore, the theory and method for solving it is not new. However, in this thesis a chapter is dedicated to this theory for two reasons. Firstly, the idea of this thesis is to present a comprehensive picture on spherical harmonics methods and diffusion approximation is a very popular and important part of it. The second reason is that the way diffusion approximation theory is is based on the moment expansion of the radiative transfer equation, which is an important building block for the development of flux-limited diffusion in the next chapter. Therefore this chapter serves as a bridge from the $P_N$-theory of the previous chapter to flux-limited diffusion theory introduced in the next chapter.

In section~\ref{sec:sh} it has been established that spherical functions can be represented using a linear combination of spherical harmonics basis functions (equation~\ref{eq:sh_reconstruction}). The coefficients to these basis functions are found by projection (equation~\ref{eq:sh_projection}). Another option for representing spherical functions is the coordinate free form given by tensor calculus. This form is derived by representing the spherical harmonics basis functions themself as linear combination of products of the components of the basis vectors, which establish the underlying coordinate system. Because this representation allows to change the coordinate system independently from the representation, it is referred to as being coordinate free. For a refresher on tensor calculus, an introductory standard such as Grinfeld~\cite{Grinfeld13} is recommended. As with the spherical harmonics expansion, the coordinate free representation can be found for the radiance field as well as the individual terms of the radiative transfer equation. This is referred to as the moment expansion or multipole expansion of the radiance field and the radiative transfer equation respectively. The fact that there are two different ways to represent $P_N$-theory, is the reason why it has so many different terms.

The moment expansion is a different approach to represent the spherical harmonics expansion of the radiance field and the radiative transfer equation. Its benefit lies in its notational efficieny, especially for lower order. However, for truncation order of $N=2$ and higher, it introduces additional redundancy which makes the standard spherical harmonics expansion much better suited when deriving computational methods from the theory, such as the $P_N$-method in chapter~\ref{sec:pnmethod}. Because the diffusion approximation introduced in this chapter and flux-limited diffusion in the next chapter is related to the first order truncation $N=1$, the moment expansion is the standard way of representing the theory. For both theories, no additional redundancy is introduced and the notational efficiency allows to express the underlying intuition easier.

The value of this chapter for the thesis, is the derivation of the moment expansion of the radiance field in section~\ref{sec:da_moment_expansion_L}, followed by the derivation of the moment expansion of the radiative transfer equation in section~\ref{sec:da_moment_expansion_RTE}. The diffusion approximation is derived as a naive solution to the moment closure problem, outlined in section~\ref{sec:moment_closure}. In section~\ref{sec:da_solver} a very efficient solver is presented, for which results are presented in section~\ref{sec:da_results}. The chapter closes with a discussion and motivates the introduction of flux-limited diffusion in chapter~\ref{sec:fld}.

\input{05_diffusion_approximation/moment_expansion_L}
\input{05_diffusion_approximation/moment_expansion_rte}
\input{05_diffusion_approximation/moment_problem}



\input{05_diffusion_approximation/diffusion_approximation_solver}
\input{05_diffusion_approximation/results}
\input{05_diffusion_approximation/discussion}
