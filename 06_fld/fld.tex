\chapter[FLD for Multiple Scattering in Participating Media]{Flux-limited Diffusion for Multiple Scattering in Participating Media}
\label{sec:fld}

In the previous chapter, the angular variable of the radiative transfer equation was discretized into a set of coupled partial differential equations, namely the $P_N$-equations. Furthermore, the chapter introduced a discretization of these equations into a system of linear equations, which could be solved using standard methods. Since the number of equations depends on the truncation order $N$, higher $N$ will result in increasingly larger systems. The results showed that the amount of computational resources required makes this approach very unattractive for practical rendering applications, especially for higher $N$ (section~\ref{sec:pn_results}).

In this chapter, flux-limited diffusion is introduced to solve the problem of rendering participating media in computer graphics. The theory has been invented in the astrophysics domain and is primarily attributed to Levermore et al.~\cite{Levermore81}. Their work introduces the theory and discusses its properties for certain canonical problems, such as a single point source within a homogeneous participating medium. In this chapter, a novel numerical method is devised, based on flux-limited diffusion theory. It allows to solve for the fluence on a finite difference grid with higher accuracy at a significantly lower cost than $P_1$.

In order to derive the theory for flux-limited diffusion, we will switch in this chapter to a different way of expressing the spherical harmonics expansion. This alternative representation is called \emph{moment expansion}. It is more efficient in regards to notation for lower order $N$ and allows to present the theory more intuitively.

In section \ref{sec:da_moment_expansion_L} and \ref{sec:da_moment_expansion_RTE}, we introduce the moment expansion for the radiance field and radiative transfer equation respectively. The section \ref{sec:moment_closure} follows by introducing the \emph{moment closure problem} and its naive solution, which gives rise to the diffusion approximation.

The diffusion approximation is a method for solving the $P_N$-equations for order $N=1$. It has been introduced to the field of computer graphics by Stam~\cite{Stam95}. The method produces the same result as the $P_N$-method but can be solved more efficiently as it reformulates the $P_1$-equations into a much simpler diffusion equation. Therefore, it offers significant advantages over the $P_N$-method in terms of required computational resources. At the same time, it gives only a poor approximation to the ground truth result. This is discussed in section~\ref{sec:diffusion_approximation}. The diffusion approximation is an important building block for the theory of flux-limited diffusion.

The chapter then continues by revisiting the moment closure problem from section~\ref{sec:moment_closure} and introduces the flux-limit constraint, which is violated by diffusion and causes energy loss. The streaming transport regime is introduced, for which an advection style equation is derived in section~\ref{sec:fld_streaming_limit_approximation}. Flux-limited diffusion is derived as a means to blend between the two extreme modes of transport using local information. This blending is driven by the variable Eddington factor, which is introduced in section~\ref{sec:fld_vef}. Various concrete realizations of the Eddington factor are given and compared in section~\ref{sec:fld_vef_factors}. Finally, an iterative solver is presented in section~\ref{sec:fld_solver}, for which results are presented in section~\ref{sec:fld_results}. The chapter closes with a discussion in section~\ref{sec:fld_discussion}.



\input{06_fld/moment_expansion_L}
\input{06_fld/moment_expansion_rte}
\input{06_fld/moment_problem}
\input{06_fld/diffusion_approximation}

\input{06_fld/moment_problem_revisited}
\input{06_fld/delta_distribution}
\input{06_fld/vef}
\input{06_fld/flux_limiters}
\input{06_fld/solver}
\input{06_fld/results}
\input{06_fld/discussion}




